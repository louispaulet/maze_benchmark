<!DOCTYPE html>
<html>
<head>
  <title>Agar.io Clone</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.10.0/p5.min.js"></script>
</head>
<body>
<script>
let player;
let foods = [];

function setup() {
  createCanvas(800, 600);
  player = new Cell(width / 2, height / 2, 20, color(0, 255, 0));
  
  // Generate food cells
  for (let i = 0; i < 100; i++) {
    let x = random(width);
    let y = random(height);
    foods.push(new Cell(x, y, 5, color(255, 0, 0)));
  }
}

function draw() {
  background(200);
  
  // Update and display player cell
  player.update();
  player.show();
  
  // Display and check collisions with food cells
  for (let i = foods.length - 1; i >= 0; i--) {
    foods[i].show();
    if (player.eats(foods[i])) {
      foods.splice(i, 1);
    }
  }
}

function keyPressed() {
  if (keyCode === UP_ARROW) {
    player.setVelocity(0, -2);
  } else if (keyCode === DOWN_ARROW) {
    player.setVelocity(0, 2);
  } else if (keyCode === LEFT_ARROW) {
    player.setVelocity(-2, 0);
  } else if (keyCode === RIGHT_ARROW) {
    player.setVelocity(2, 0);
  }
}

function keyReleased() {
  if (keyCode === UP_ARROW || keyCode === DOWN_ARROW) {
    player.setVelocity(player.vel.x, 0);
  } else if (keyCode === LEFT_ARROW || keyCode === RIGHT_ARROW) {
    player.setVelocity(0, player.vel.y);
  }
}

class Cell {
  constructor(x, y, r, col) {
    this.pos = createVector(x, y);
    this.r = r;
    this.color = col;
    this.vel = createVector(0, 0);
  }
  
  update() {
    this.pos.add(this.vel);
    // Keep the cell within the canvas boundaries
    this.pos.x = constrain(this.pos.x, this.r, width - this.r);
    this.pos.y = constrain(this.pos.y, this.r, height - this.r);
  }
  
  show() {
    fill(this.color);
    noStroke();
    ellipse(this.pos.x, this.pos.y, this.r * 2, this.r * 2);
  }
  
  setVelocity(x, y) {
    this.vel = createVector(x, y);
  }
  
  eats(other) {
    let d = p5.Vector.dist(this.pos, other.pos);
    if (d < this.r + other.r) {
      // Increase the player's size
      let sumArea = PI * this.r * this.r + PI * other.r * other.r;
      this.r = sqrt(sumArea / PI);
      return true;
    } else {
      return false;
    }
  }
}
</script>
</body>
</html>
